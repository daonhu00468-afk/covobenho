<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Qu·∫£n L√Ω C√¢y Vi·∫øt</title>

<script src="https://unpkg.com/html5-qrcode"></script>

<style>
body{
font-family:Arial;
margin:0;
background:#f2f2f2;
}

header{
background:#4CAF50;
color:white;
padding:15px;
display:flex;
justify-content:space-between;
align-items:center;
font-weight:bold;
}

.container{
padding:15px;
}

input{
width:100%;
padding:12px;
margin:6px 0;
border-radius:10px;
border:1px solid #ccc;
}

button{
width:100%;
padding:12px;
margin:6px 0;
border:none;
border-radius:10px;
font-weight:bold;
}

.add-btn{background:#4CAF50;color:white;}
.qr-btn{background:#2196F3;color:white;}
.logout-btn{background:#555;color:white;}
.small-btn{
width:auto;
padding:6px 10px;
border-radius:8px;
font-size:13px;
color:white;
}

.pen-item{
background:white;
padding:12px;
border-radius:12px;
margin:10px 0;
box-shadow:0 2px 6px rgba(0,0,0,0.1);
}

#suggestions div:hover{
background:#eee;
}

</style>
</head>

<body>

<div id="loginPage" class="container">
<h2>ƒêƒÉng nh·∫≠p</h2>
<input type="text" id="username" placeholder="Nh·∫≠p t√™n c·ªßa b·∫°n">
<button onclick="login()">V√†o</button>
</div>

<div id="mainPage" style="display:none;">

<header>
<span>üìí Qu·∫£n L√Ω C√¢y Vi·∫øt</span>
<span>T·ªïng: <span id="totalCount">0</span></span>
</header>

<div class="container">

<h3 id="welcome"></h3>

<input type="text" id="penName" placeholder="T√™n c√¢y vi·∫øt">
<input type="text" id="penNote" placeholder="Ch√∫ th√≠ch">
<input type="text" id="penCode" placeholder="M√£ c√¢y vi·∫øt">

<button class="qr-btn" onclick="startQR()">üì∑ Qu√©t m√£</button>
<div id="reader" style="margin:10px 0;"></div>

<button class="add-btn" onclick="addPen()">Th√™m c√¢y vi·∫øt</button>

<hr>

<input type="text" id="searchInput"
placeholder="üîç T√¨m theo t√™n ho·∫∑c m√£..."
oninput="searchPens()">

<div id="suggestions"
style="background:white;border-radius:10px;overflow:hidden;"></div>

<div id="penList"></div>

<button class="logout-btn" onclick="logout()">ƒêƒÉng xu·∫•t</button>

</div>
</div>

<script>

let pens = JSON.parse(localStorage.getItem("pens")) || [];

function login(){
let name=document.getElementById("username").value;
if(name==="") return;
localStorage.setItem("user",name);
showMain();
}

function logout(){
localStorage.removeItem("user");
location.reload();
}

function showMain(){
document.getElementById("loginPage").style.display="none";
document.getElementById("mainPage").style.display="block";
document.getElementById("welcome").innerText="Xin ch√†o: "+localStorage.getItem("user");
renderPens();
}

if(localStorage.getItem("user")){
showMain();
}

function addPen(){
let name=document.getElementById("penName").value;
let note=document.getElementById("penNote").value;
let code=document.getElementById("penCode").value;

if(name===""||code===""){
alert("Nh·∫≠p t√™n v√† m√£");
return;
}

pens.push({name,note,code});
localStorage.setItem("pens",JSON.stringify(pens));

document.getElementById("penName").value="";
document.getElementById("penNote").value="";
document.getElementById("penCode").value="";

renderPens();
}

function renderPens(){
let list=document.getElementById("penList");
list.innerHTML="";
pens.forEach((pen,index)=>{
list.innerHTML+=`
<div class="pen-item">
<b>${pen.name}</b><br>
<small>${pen.note||""}</small><br>
<small><b>M√£:</b> ${pen.code}</small><br><br>
<button class="small-btn" style="background:red;"
onclick="deletePen(${index})">Xo√°</button>
</div>`;
});
document.getElementById("totalCount").innerText=pens.length;
}

function deletePen(i){
pens.splice(i,1);
localStorage.setItem("pens",JSON.stringify(pens));
renderPens();
}

function searchPens(){
const keyword=document.getElementById("searchInput").value.toLowerCase();
const suggestBox=document.getElementById("suggestions");
const list=document.getElementById("penList");

suggestBox.innerHTML="";
list.innerHTML="";

if(keyword===""){
renderPens();
return;
}

let matched=pens.filter(p=>
p.name.toLowerCase().includes(keyword)||
p.code.toLowerCase().includes(keyword)
);

suggestBox.innerHTML=
`<div style="padding:8px;font-weight:bold;color:#4CAF50;">
T√¨m th·∫•y ${matched.length} k·∫øt qu·∫£
</div>`;

if(matched.length===0){
suggestBox.innerHTML+=
`<div style="padding:8px;color:red;">Ch∆∞a mua</div>`;
}

matched.forEach(p=>{
suggestBox.innerHTML+=
`<div style="padding:8px;border-top:1px solid #eee;cursor:pointer;"
onclick="selectSuggestion('${p.name}','${p.code}')">
${p.name} - ${p.code}
</div>`;
});

matched.forEach((pen,index)=>{
list.innerHTML+=`
<div class="pen-item">
<b>${pen.name}</b><br>
<small>${pen.note||""}</small><br>
<small><b>M√£:</b> ${pen.code}</small><br><br>
<button class="small-btn" style="background:red;"
onclick="deletePen(${index})">Xo√°</button>
</div>`;
});
}

function selectSuggestion(name,code){
document.getElementById("searchInput").value=name;
document.getElementById("suggestions").innerHTML="";
renderPens();
}

function startQR(){
const qr=new Html5Qrcode("reader");
qr.start(
{facingMode:"environment"},
{fps:10,qrbox:250},
(decodedText)=>{
document.getElementById("penCode").value=decodedText;
qr.stop();
document.getElementById("reader").innerHTML="";
},
()=>{}
);
}

</script>

</body>
</html>
