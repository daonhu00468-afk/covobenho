<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Quáº£n LÃ½ CÃ¢y Viáº¿t</title>

<script src="https://unpkg.com/html5-qrcode"></script>

<style>
*{box-sizing:border-box;}
body{margin:0;font-family:Arial;background:#eef2f3;}

header{
  background:linear-gradient(135deg,#2e7d32,#43a047);
  color:white;
  padding:35px 20px 30px;
  text-align:center;
  border-bottom-left-radius:25px;
  border-bottom-right-radius:25px;
  box-shadow:0 5px 15px rgba(0,0,0,0.2);
}

.title{font-size:28px;font-weight:bold;}
#total{
  margin-top:12px;
  font-size:18px;
  background:white;
  color:#2e7d32;
  display:inline-block;
  padding:8px 22px;
  border-radius:30px;
  font-weight:bold;
}

.container{padding:20px;max-width:550px;margin:auto;}

input{
  width:100%;
  padding:15px;
  margin:10px 0;
  border-radius:15px;
  border:1px solid #ccc;
  font-size:18px;
}

input:focus{border:2px solid #2e7d32;}

button{
  width:100%;
  padding:15px;
  margin:10px 0;
  border:none;
  border-radius:15px;
  font-size:18px;
  font-weight:bold;
  cursor:pointer;
}

.addBtn{background:#4CAF50;color:white;}
.scanBtn{background:#2196F3;color:white;}
.logoutBtn{background:#555;color:white;}
.deleteBtn{background:#e53935;color:white;width:90px;}
.editBtn{background:#fb8c00;color:white;width:90px;}

.card{
  background:white;
  padding:18px;
  border-radius:18px;
  margin-top:18px;
  box-shadow:0 6px 15px rgba(0,0,0,0.1);
}

.resultCount{font-weight:bold;color:#2e7d32;}
</style>
</head>

<body>

<header>
  <div class="title">ğŸ“’ Quáº£n LÃ½ CÃ¢y Viáº¿t</div>
  <div id="total">Tá»•ng: 0</div>
</header>

<div class="container">

<div id="loginBox">
<h2>ÄÄƒng nháº­p</h2>
<input id="username" placeholder="Nháº­p tÃªn cá»§a báº¡n">
<button class="addBtn" onclick="login()">VÃ o há»‡ thá»‘ng</button>
</div>

<div id="mainBox" style="display:none">

<h2 id="hello"></h2>

<h3>â• ThÃªm / Sá»­a cÃ¢y viáº¿t</h3>
<input id="ten" placeholder="TÃªn cÃ¢y viáº¿t">
<input id="note" placeholder="ChÃº thÃ­ch">
<input id="ma" placeholder="MÃ£ cÃ¢y viáº¿t">

<button class="scanBtn" onclick="scanAdd()">ğŸ“· QuÃ©t mÃ£ Ä‘á»ƒ thÃªm</button>
<div id="readerAdd"></div>

<button class="addBtn" onclick="them()">LÆ°u</button>

<hr>

<h3>ğŸ” TÃ¬m kiáº¿m</h3>
<input id="search" placeholder="GÃµ tÃªn hoáº·c mÃ£..." onkeyup="tim()">
<div id="count" class="resultCount"></div>

<button class="scanBtn" onclick="scanSearch()">ğŸ“· QuÃ©t mÃ£ Ä‘á»ƒ tÃ¬m</button>
<div id="readerSearch"></div>

<div id="list"></div>

<button class="logoutBtn" onclick="logout()">ÄÄƒng xuáº¥t</button>

</div>
</div>
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
import { getFirestore, collection, addDoc, getDocs, deleteDoc, doc, updateDoc } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

/* ğŸ”¥ Cáº¤U HÃŒNH FIREBASE */
const firebaseConfig = {
  apiKey: "AIzaSyD1MtCqQ6Rw-2l7IF-tvLoKqYc3sK1pk2o",
  authDomain: "quan-ly-cay-viet.firebaseapp.com",
  projectId: "quan-ly-cay-viet",
  storageBucket: "quan-ly-cay-viet.firebasestorage.app",
  messagingSenderId: "460270880689",
  appId: "1:460270880689:web:c0e781de3b16a928a35f90"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

let ds = [];
let editId = null;

/* LOGIN */
window.login=function(){
  let name=document.getElementById("username").value;
  if(name=="") return alert("Nháº­p tÃªn!");
  localStorage.setItem("user",name);
  location.reload();
}

window.logout=function(){
  localStorage.removeItem("user");
  location.reload();
}

if(localStorage.getItem("user")){
  document.getElementById("loginBox").style.display="none";
  document.getElementById("mainBox").style.display="block";
  document.getElementById("hello").innerHTML="Xin chÃ o: "+localStorage.getItem("user");
  loadData();
}

/* LOAD FIREBASE */
async function loadData(){
  ds=[];
  const snapshot=await getDocs(collection(db,"pens"));
  snapshot.forEach(docSnap=>{
    ds.push({id:docSnap.id,...docSnap.data()});
  });
  hienThi();
}

/* HIá»‚N THá»Š */
function hienThi(data=ds){
  let html="";
  data.forEach(p=>{
    html+=`
    <div class="card">
      <h2>${p.ten}</h2>
      <p>${p.note}</p>
      <p><b>MÃ£:</b> ${p.ma}</p>
      <button class="editBtn" onclick="sua('${p.id}')">Sá»­a</button>
      <button class="deleteBtn" onclick="xoa('${p.id}')">XoÃ¡</button>
    </div>`;
  });
  document.getElementById("list").innerHTML=html;
  document.getElementById("total").innerHTML="Tá»•ng: "+data.length;
}

/* THÃŠM */
window.them=async function(){
  let ten=document.getElementById("ten").value;
  let note=document.getElementById("note").value;
  let ma=document.getElementById("ma").value;

  if(ten==""||ma=="") return alert("Nháº­p Ä‘á»§ thÃ´ng tin!");

  if(editId==null){
    await addDoc(collection(db,"pens"),{ten,note,ma});
  }else{
    await updateDoc(doc(db,"pens",editId),{ten,note,ma});
    editId=null;
  }

  document.getElementById("ten").value="";
  document.getElementById("note").value="";
  document.getElementById("ma").value="";

  loadData();
}

/* Sá»¬A */
window.sua=function(id){
  let p=ds.find(x=>x.id==id);
  document.getElementById("ten").value=p.ten;
  document.getElementById("note").value=p.note;
  document.getElementById("ma").value=p.ma;
  editId=id;
}

/* XOÃ */
window.xoa=async function(id){
  await deleteDoc(doc(db,"pens",id));
  loadData();
}

/* TÃŒM */
window.tim=function(){
  let key=document.getElementById("search").value.toLowerCase();
  if(key==""){
    hienThi();
    document.getElementById("count").innerHTML="";
    return;
  }

  let loc=ds.filter(p=>
    p.ten.toLowerCase().includes(key)||
    p.ma.toLowerCase().includes(key)
  );

  hienThi(loc);
  document.getElementById("count").innerHTML="TÃ¬m tháº¥y "+loc.length+" káº¿t quáº£";
}

/* QR */
window.scanAdd=function(){
  let qr=new Html5Qrcode("readerAdd");
  qr.start({facingMode:"environment"},{fps:10,qrbox:250},code=>{
    document.getElementById("ma").value=code;
    qr.stop();
    document.getElementById("readerAdd").innerHTML="";
  });
}

window.scanSearch=function(){
  let qr=new Html5Qrcode("readerSearch");
  qr.start({facingMode:"environment"},{fps:10,qrbox:250},code=>{
    document.getElementById("search").value=code;
    tim();
    qr.stop();
    document.getElementById("readerSearch").innerHTML="";
  });
}
  /* ===== KHOÃ WEB ===== */
let KHOA_WEB = true; // true = khoÃ¡ | false = má»Ÿ

if (KHOA_WEB) {
  document.body.innerHTML = `
    <div style="
      height:100vh;
      display:flex;
      justify-content:center;
      align-items:center;
      flex-direction:column;
      background:linear-gradient(135deg,#2e7d32,#43a047);
      color:white;
      font-family:Arial;
      text-align:center;
    ">
      <h1>ğŸš« Há»† THá»NG ÄANG Báº¢O TRÃŒ</h1>
      <p>Website táº¡m thá»i khÃ³a.</p>
      <p>Vui lÃ²ng quay láº¡i sau.</p>
    </div>
  `;
}
</script>


</body>
</html>
