<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Qu·∫£n L√Ω C√¢y Vi·∫øt</title>

<script src="https://unpkg.com/html5-qrcode"></script>

<style>
*{
  box-sizing:border-box;
}

body{
  margin:0;
  font-family: Arial, sans-serif;
  background:#eef2f3;
}

/* HEADER */
header{
  background:linear-gradient(135deg,#2e7d32,#43a047);
  color:white;
  padding:35px 20px 30px 20px;
  text-align:center;
  border-bottom-left-radius:25px;
  border-bottom-right-radius:25px;
  box-shadow:0 5px 15px rgba(0,0,0,0.2);
}

.title{
  font-size:28px;
  font-weight:bold;
  letter-spacing:1px;
}

#total{
  margin-top:12px;
  font-size:18px;
  background:white;
  color:#2e7d32;
  display:inline-block;
  padding:8px 22px;
  border-radius:30px;
  font-weight:bold;
}

/* CONTAINER */
.container{
  padding:20px;
  max-width:550px;
  margin:auto;
}

/* INPUT */
input{
  width:100%;
  padding:15px;
  margin:10px 0;
  border-radius:15px;
  border:1px solid #ccc;
  font-size:18px;
  outline:none;
}

input:focus{
  border:2px solid #2e7d32;
}

/* BUTTON */
button{
  width:100%;
  padding:15px;
  margin:10px 0;
  border:none;
  border-radius:15px;
  font-size:18px;
  font-weight:bold;
  cursor:pointer;
  transition:0.2s;
}

button:active{
  transform:scale(0.97);
}

.addBtn{ background:#4CAF50; color:white;}
.scanBtn{ background:#2196F3; color:white;}
.logoutBtn{ background:#555; color:white;}
.deleteBtn{ background:#e53935; color:white; width:90px;}
.editBtn{ background:#fb8c00; color:white; width:90px;}

.card{
  background:white;
  padding:18px;
  border-radius:18px;
  margin-top:18px;
  box-shadow:0 6px 15px rgba(0,0,0,0.1);
}

.card h2{
  margin:0 0 5px 0;
}

.resultCount{
  font-weight:bold;
  color:#2e7d32;
  margin-top:5px;
}
</style>
</head>

<body>

<header>
  <div class="title">üìí Qu·∫£n L√Ω C√¢y Vi·∫øt</div>
  <div id="total">T·ªïng: 0</div>
</header>

<div class="container">

<div id="loginBox">
<h2>ƒêƒÉng nh·∫≠p</h2>
<input id="username" placeholder="Nh·∫≠p t√™n c·ªßa b·∫°n">
<button class="addBtn" onclick="login()">V√†o h·ªá th·ªëng</button>
</div>

<div id="mainBox" style="display:none">

<h2 id="hello"></h2>

<h3>‚ûï Th√™m / S·ª≠a c√¢y vi·∫øt</h3>
<input id="ten" placeholder="T√™n c√¢y vi·∫øt">
<input id="note" placeholder="Ch√∫ th√≠ch">
<input id="ma" placeholder="M√£ c√¢y vi·∫øt">

<button class="scanBtn" onclick="scanAdd()">üì∑ Qu√©t m√£ ƒë·ªÉ th√™m</button>
<div id="readerAdd"></div>

<button class="addBtn" onclick="them()">L∆∞u</button>

<hr>

<h3>üîç T√¨m ki·∫øm</h3>
<input id="search" placeholder="G√µ t√™n ho·∫∑c m√£..." onkeyup="tim()">
<div id="count" class="resultCount"></div>

<button class="scanBtn" onclick="scanSearch()">üì∑ Qu√©t m√£ ƒë·ªÉ t√¨m</button>
<div id="readerSearch"></div>

<div id="list"></div>

<button class="logoutBtn" onclick="logout()">ƒêƒÉng xu·∫•t</button>

</div>
</div>

<script>
let ds = JSON.parse(localStorage.getItem("pens")) || [];
let editIndex = -1;

/* LOGIN */
function login(){
  let name = document.getElementById("username").value;
  if(name=="") return alert("Nh·∫≠p t√™n!");
  localStorage.setItem("user", name);
  location.reload();
}

function logout(){
  localStorage.removeItem("user");
  location.reload();
}

if(localStorage.getItem("user")){
  document.getElementById("loginBox").style.display="none";
  document.getElementById("mainBox").style.display="block";
  document.getElementById("hello").innerHTML="Xin ch√†o: "+localStorage.getItem("user");
  hienThi();
}

/* C·∫¨P NH·∫¨T T·ªîNG */
function updateTotal(){
  document.getElementById("total").innerHTML="T·ªïng: "+ds.length;
}

/* HI·ªÇN TH·ªä */
function hienThi(data=ds){
  let html="";
  data.forEach((p,i)=>{
    html+=`
    <div class="card">
      <h2>${p.ten}</h2>
      <p>${p.note}</p>
      <p><b>M√£:</b> ${p.ma}</p>
      <button class="editBtn" onclick="sua(${i})">S·ª≠a</button>
      <button class="deleteBtn" onclick="xoa(${i})">Xo√°</button>
    </div>`;
  });
  document.getElementById("list").innerHTML=html;
  updateTotal();
}

/* TH√äM / S·ª¨A */
function them(){
  let ten=document.getElementById("ten").value;
  let note=document.getElementById("note").value;
  let ma=document.getElementById("ma").value;

  if(ten==""||ma=="") return alert("Nh·∫≠p ƒë·ªß th√¥ng tin!");

  if(editIndex==-1){
    ds.push({ten,note,ma});
  }else{
    ds[editIndex]={ten,note,ma};
    editIndex=-1;
  }

  localStorage.setItem("pens",JSON.stringify(ds));

  document.getElementById("ten").value="";
  document.getElementById("note").value="";
  document.getElementById("ma").value="";

  hienThi();
}

/* S·ª¨A */
function sua(i){
  document.getElementById("ten").value=ds[i].ten;
  document.getElementById("note").value=ds[i].note;
  document.getElementById("ma").value=ds[i].ma;
  editIndex=i;
}

/* XO√Å */
function xoa(i){
  ds.splice(i,1);
  localStorage.setItem("pens",JSON.stringify(ds));
  hienThi();
}

/* T√åM */
function tim(){
  let key=document.getElementById("search").value.toLowerCase();
  if(key==""){
    hienThi();
    document.getElementById("count").innerHTML="";
    return;
  }

  let loc=ds.filter(p=>
    p.ten.toLowerCase().includes(key)||
    p.ma.toLowerCase().includes(key)
  );

  hienThi(loc);
  document.getElementById("count").innerHTML=
  "T√¨m th·∫•y "+loc.length+" k·∫øt qu·∫£";
}

/* QR TH√äM */
function scanAdd(){
  let qr=new Html5Qrcode("readerAdd");
  qr.start({facingMode:"environment"},
  {fps:10,qrbox:250},
  code=>{
    document.getElementById("ma").value=code;
    qr.stop();
    document.getElementById("readerAdd").innerHTML="";
  });
}

/* QR T√åM */
function scanSearch(){
  let qr=new Html5Qrcode("readerSearch");
  qr.start({facingMode:"environment"},
  {fps:10,qrbox:250},
  code=>{
    document.getElementById("search").value=code;
    tim();
    qr.stop();
    document.getElementById("readerSearch").innerHTML="";
  });
}
</script>

</body>
</html>
