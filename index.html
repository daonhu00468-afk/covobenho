<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Quáº£n LÃ½ CÃ¢y Viáº¿t</title>

<script src="https://unpkg.com/html5-qrcode"></script>

<style>
body{
  margin:0;
  font-family: Arial, sans-serif;
  background:#f4f6f9;
}

header{
  background:#2e7d32;
  color:white;
  padding:20px;
  text-align:center;
  font-size:24px;
  font-weight:bold;
}

.container{
  padding:20px;
  max-width:500px;
  margin:auto;
}

input{
  width:100%;
  padding:15px;
  margin:10px 0;
  border-radius:12px;
  border:1px solid #ccc;
  font-size:18px;
}

button{
  width:100%;
  padding:15px;
  margin:10px 0;
  border:none;
  border-radius:12px;
  font-size:18px;
  font-weight:bold;
  cursor:pointer;
}

.addBtn{ background:#4CAF50; color:white;}
.scanBtn{ background:#2196F3; color:white;}
.logoutBtn{ background:#555; color:white;}
.deleteBtn{ background:red; color:white; width:100px;}

.card{
  background:white;
  padding:15px;
  border-radius:15px;
  margin-top:15px;
  box-shadow:0 4px 10px rgba(0,0,0,0.1);
}

.resultCount{
  font-weight:bold;
  color:#2e7d32;
  margin-top:5px;
}
</style>
</head>

<body>

<header>ğŸ“’ Quáº£n LÃ½ CÃ¢y Viáº¿t</header>

<div class="container">

<div id="loginBox">
<h2>ÄÄƒng nháº­p</h2>
<input id="username" placeholder="Nháº­p tÃªn cá»§a báº¡n">
<button class="addBtn" onclick="login()">VÃ o há»‡ thá»‘ng</button>
</div>

<div id="mainBox" style="display:none">

<h2 id="hello"></h2>

<!-- ThÃªm -->
<h3>â• ThÃªm cÃ¢y viáº¿t</h3>
<input id="ten" placeholder="TÃªn cÃ¢y viáº¿t">
<input id="note" placeholder="ChÃº thÃ­ch">
<input id="ma" placeholder="MÃ£ cÃ¢y viáº¿t">

<button class="scanBtn" onclick="scanAdd()">ğŸ“· QuÃ©t mÃ£ Ä‘á»ƒ thÃªm</button>
<div id="readerAdd"></div>

<button class="addBtn" onclick="them()">ThÃªm cÃ¢y viáº¿t</button>

<hr>

<!-- TÃ¬m kiáº¿m -->
<h3>ğŸ” TÃ¬m kiáº¿m</h3>
<input id="search" placeholder="GÃµ tÃªn hoáº·c mÃ£..." onkeyup="tim()">
<div id="count" class="resultCount"></div>

<button class="scanBtn" onclick="scanSearch()">ğŸ“· QuÃ©t mÃ£ Ä‘á»ƒ tÃ¬m</button>
<div id="readerSearch"></div>

<div id="list"></div>

<button class="logoutBtn" onclick="logout()">ÄÄƒng xuáº¥t</button>

</div>
</div>

<script>
let ds = JSON.parse(localStorage.getItem("pens")) || [];

/* LOGIN */
function login(){
  let name = document.getElementById("username").value;
  if(name=="") return alert("Nháº­p tÃªn!");
  localStorage.setItem("user", name);
  location.reload();
}

function logout(){
  localStorage.removeItem("user");
  location.reload();
}

if(localStorage.getItem("user")){
  document.getElementById("loginBox").style.display="none";
  document.getElementById("mainBox").style.display="block";
  document.getElementById("hello").innerHTML="Xin chÃ o: "+localStorage.getItem("user");
  hienThi();
}

/* HIá»‚N THá»Š */
function hienThi(data=ds){
  let html="";
  data.forEach((p,i)=>{
    html+=`
    <div class="card">
      <h2>${p.ten}</h2>
      <p>${p.note}</p>
      <p><b>MÃ£:</b> ${p.ma}</p>
      <button class="deleteBtn" onclick="xoa(${i})">XoÃ¡</button>
    </div>`;
  });
  document.getElementById("list").innerHTML=html;
}

/* THÃŠM */
function them(){
  let ten=document.getElementById("ten").value;
  let note=document.getElementById("note").value;
  let ma=document.getElementById("ma").value;

  if(ten==""||ma=="") return alert("Nháº­p Ä‘á»§ thÃ´ng tin!");

  ds.push({ten,note,ma});
  localStorage.setItem("pens",JSON.stringify(ds));
  document.getElementById("ten").value="";
  document.getElementById("note").value="";
  document.getElementById("ma").value="";
  hienThi();
}

/* XOÃ */
function xoa(i){
  ds.splice(i,1);
  localStorage.setItem("pens",JSON.stringify(ds));
  hienThi();
}

/* TÃŒM GÃ• */
function tim(){
  let key=document.getElementById("search").value.toLowerCase();
  if(key==""){
    hienThi();
    document.getElementById("count").innerHTML="";
    return;
  }

  let loc=ds.filter(p=>
    p.ten.toLowerCase().includes(key)||
    p.ma.toLowerCase().includes(key)
  );

  hienThi(loc);
  document.getElementById("count").innerHTML=
  "TÃ¬m tháº¥y "+loc.length+" káº¿t quáº£";
}

/* QR THÃŠM */
function scanAdd(){
  let qr=new Html5Qrcode("readerAdd");
  qr.start({facingMode:"environment"},
  {fps:10,qrbox:250},
  code=>{
    document.getElementById("ma").value=code;
    qr.stop();
    document.getElementById("readerAdd").innerHTML="";
  });
}

/* QR TÃŒM */
function scanSearch(){
  let qr=new Html5Qrcode("readerSearch");
  qr.start({facingMode:"environment"},
  {fps:10,qrbox:250},
  code=>{
    document.getElementById("search").value=code;
    tim();
    qr.stop();
    document.getElementById("readerSearch").innerHTML="";
  });
}
</script>

</body>
</html>
